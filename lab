#### NLB LAB ####


### WWW1 ###

#Rename NIC
Get-NetAdapter -Name Ethernet | Rename-NetAdapter -NewName Private
Get-NetAdapter -Name "Ethernet 2" | Rename-NetAdapter -NewName NLB

#Assign IP and DNS CLient
New-netipaddress -ipaddress 10.0.0.9 -prefixlength 24 -defaultgateway 10.0.0.1 -interfacealias Private | Set-dnsclientserveraddress -serveraddresses 10.0.0.2
New-netipaddress -ipaddress 10.0.0.10 -prefixlength 24 -defaultgateway 10.0.0.1 -interfacealias NLB | Set-dnsclientserveraddress -serveraddresses 10.0.0.2

#Join Domain and Rename
add-computer -newname www1 -domainname contoso.com -domaincredential contoso\administrator -restart


### WWW2 ###

#Rename NIC
Get-NetAdapter -Name Ethernet | Rename-NetAdapter -NewName Private
Get-NetAdapter -Name "Ethernet 2" | Rename-NetAdapter -NewName NLB

#Assign IP and DNS CLient
New-netipaddress -ipaddress 10.0.0.11 -prefixlength 24 -defaultgateway 10.0.0.1 -interfacealias Private | Set-dnsclientserveraddress -serveraddresses 10.0.0.2
New-netipaddress -ipaddress 10.0.0.12 -prefixlength 24 -defaultgateway 10.0.0.1 -interfacealias NLB | Set-dnsclientserveraddress -serveraddresses 10.0.0.2

#Join Domain and Rename
add-computer -newname www2 -domainname contoso.com -domaincredential contoso\administrator -restart


### Test Management from DC Powershell of WWW1 and WWW2 ###
$session=New-PsSession –ComputerName www1, www2
Invoke-Command –session $session {Get-WindowsFeature | where{$_.InstallState -eq "Installed"} | fl pscomputername, name, displayname, featuretype}
Invoke-Command –session $session {Install-WindowsFeature -name Web-Server, NLB -IncludeManagementTools}
Invoke-Command –session $session {Get-WindowsFeature -Name NLB,Web-Server}
Invoke-Command –session $session {Test-Path C:\inetpub}
Invoke-Command –session $session {hostname}
Invoke-Command –session $session {New-Item -Path 'C:\inetpub\mysite' -ItemType Directory}
Invoke-Command –session $session {New-Item C:\inetpub\mysite\index.html -ItemType File}
Invoke-Command –session $session {Set-Content C:\inetpub\mysite\index.html '<html><head><title>My Site</title></head><body>This is my website</body></html>'}
Invoke-Command –session $session {Get-Content C:\inetpub\mysite\index.html}

