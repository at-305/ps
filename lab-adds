##########
## NAT1 ##
##########

#Rename NIC
Get-NetAdapter | Select Name, macaddress
Get-NetAdapter -Name "Ethernet" | Rename-NetAdapter -NewName West
Get-NetAdapter -Name "Ethernet 2" | Rename-NetAdapter -NewName WAN
Get-NetAdapter -Name "Ethernet 3" | Rename-NetAdapter -NewName Public

#Set IP Address
New-netipaddress -ipaddress 172.16.0.1 -prefixlength 21 -interfacealias West
New-netipaddress -ipaddress 172.16.16.1 -prefixlength 30 -interfacealias WAN

#Set DNS Address
Set-dnsclientserveraddress -serveraddresses 172.16.0.2,172.16.0.3 -interfacealias *

#Install Routing Role
Get-WindowsFeature | where{$_.InstallState -eq "Installed"} | ft name, displayname, featuretype
Install-Windowsfeature -name routing -includemanagementtools -restart

#Rename computer
Rename-computer -newname nat1 -restart

#Configure NAT via GUI 'routing and remote access'
Enable and Configure > Nat > Public, WAN > Add Interface for West right click IPV4/NAT
Install RIP > right CLick IPV4/General 'new routing protocol' RIP2. New Interface on WAN link, check all boxes on advacned tab.

#Enable Ping
Enable-NetFirewallRule -DisplayName "File and Print*"

##########
## NAT2 ##
##########

#Rename NIC
Get-NetAdapter | Select Name, macaddress
Get-NetAdapter -Name "Ethernet" | Rename-NetAdapter -NewName East
Get-NetAdapter -Name "Ethernet 2" | Rename-NetAdapter -NewName WAN
Get-NetAdapter -Name "Ethernet 3" | Rename-NetAdapter -NewName Public

#Set IP Address
New-netipaddress -ipaddress 172.16.8.1 -prefixlength 21 -interfacealias East
New-netipaddress -ipaddress 172.16.16.2 -prefixlength 30 -interfacealias WAN

#Set DNS Address
Set-dnsclientserveraddress -serveraddresses 172.16.8.2,172.16.8.3 -interfacealias *

#Install Routing Role
Get-WindowsFeature | where{$_.InstallState -eq "Installed"} | ft name, displayname, featuretype
Install-Windowsfeature -name routing -includemanagementtools -restart

#Rename computer
Rename-computer -newname nat2 -restart

#Configure NAT via GUI 'routing and remote access'
Enable and Configure > Nat > Public, WAN > Add Interface for West right click IPV4/NAT
Install RIP > right CLick IPV4/General 'new routing protocol' RIP2. New Interface on WAN link, check all boxes on advacned tab.

#Enable Ping
Enable-NetFirewallRule -DisplayName "File and Print*"

###############
## ParentDC1 ##
###############

#Set IP Address, Default Gateway and Upstream DNS Server (Google.com)
New-netipaddress -ipaddress 172.16.0.2 -prefixlength 21 -interfacealias Ethernet -DefaultGateway 172.16.0.1 | Set-dnsclientserveraddress -serveraddresses 8.8.8.8,8.8.4.4

#Rename computer
Rename-computer -newname pdc1 -restart

#Install ADDS Role
Install-Windowsfeature -name ad-domain-services -includemanagementtools -restart

#Install ADDS FOrest
Install-ADDSForest -domainname contoso.com -safemodeadministratorpassword (convertto-securestring Pa11word -AsPlainText -Force) -Force

#Configure DNS Reverse Lookup Zone for East/West and Wan
Add-DnsServerPrimaryZone -NetworkID 172.16.0.0/16 -ReplicationScope Domain -DynamicUpdate Secure

#Register DNS CLient to auto create PTR record for pdc1 since dns was not configured
Get-DNSResourceRecord -ZoneName 16.172.in-addr.arpa
Register-DNSClient
Get-DNSResourceRecord -ZoneName 16.172.in-addr.arpa
#Note the PTR record was created.

#Configure AD Sites and Services via GUI (no powershell commands?)
Rename Default-Site to "west"
Add new Site "East"
In Inter Site Transports, rename DefaultSiteIPLink to "WestandEast"
Continue lab at minute 25

